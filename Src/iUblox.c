#include "global.h"
#include "Usart.h"
#include "FiFOuart.h"
#include "iUblox.h"
#define gUartDatPort_2 (Huart[UBLOX])
#define kal_sleep_task(x)  HAL_Delay(x*4)
void UbloxCloseGGA()
{
	char gcGGA_Close[16]	= {0xB5,0x62,0x06,0x01,0x08,0x00,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x24};
	char gcGLL_Close[16]	= {0xB5,0x62,0x06,0x01,0x08,0x00,0xF0,0x01,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x2B};
	char gcGSA_Close[16]	= {0xB5,0x62,0x06,0x01,0x08,0x00,0xF0,0x02,0x00,0x00,0x00,0x00,0x00,0x01,0x02,0x32};
	char gcGSV_Close[16]	= {0xB5,0x62,0x06,0x01,0x08,0x00,0xF0,0x03,0x00,0x00,0x00,0x00,0x00,0x01,0x03,0x39};
	char gcRMC_Close[16] 	= {0xB5,0x62,0x06,0x01,0x08,0x00,0xF0,0x04,0x00,0x00,0x00,0x00,0x00,0x01,0x04,0x40};
	char gcVTG_Close[16] 	= {0xB5,0x62,0x06,0x01,0x08,0x00,0xF0,0x05,0x00,0x00,0x00,0x00,0x00,0x01,0x05,0x47};
	char gcZDA_Close[16] 	= {0xB5,0x62,0x06,0x01,0x08,0x00,0xF0,0x08,0x00,0x00,0x00,0x00,0x00,0x01,0x08,0x5C};

	kal_sleep_task(100);
	UartSendBuffer(&Huart[UBLOX], (unsigned char *)gcGGA_Close, sizeof(gcGGA_Close));
	kal_sleep_task(2);
	UartSendBuffer(&Huart[UBLOX], (unsigned char *)gcGLL_Close, sizeof(gcGLL_Close));
	kal_sleep_task(2);
	UartSendBuffer(&Huart[UBLOX], (unsigned char *)gcGSA_Close, sizeof(gcGSA_Close));
	kal_sleep_task(2);
	UartSendBuffer(&Huart[UBLOX], (unsigned char *)gcGSV_Close, sizeof(gcGSV_Close));
	kal_sleep_task(2);
	UartSendBuffer(&Huart[UBLOX], (unsigned char *)gcRMC_Close, sizeof(gcRMC_Close));
	kal_sleep_task(2);
	UartSendBuffer(&Huart[UBLOX], (unsigned char *)gcVTG_Close, sizeof(gcVTG_Close));
	kal_sleep_task(2);
	UartSendBuffer(&Huart[UBLOX], (unsigned char *)gcZDA_Close, sizeof(gcZDA_Close));
	kal_sleep_task(2);
	
}

void SetUbloxUartBaudrate()//2?1?¡À?ublox¨¦¨¨??¨º?¨¨?
{
	char g_cUART1_9600_SET[28]  	= {0xB5,0x62,0x06,0x00,0x14,0x00,0x01,0x00,0x00,0x00,0xD0,0x08,0x00,0x00,0x00,0x80,0x25,0x00,0x07,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0xA0,0xA9 };
	char g_cUART1_19200_SET[28]  	= {0xB5,0x62,0x06,0x00,0x14,0x00,0x01,0x00,0x00,0x00,0xD0,0x08,0x00,0x00,0x00,0x4B,0x00,0x00,0x07,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x46,0x4B };
	char g_cUART1_38400_SET[28]  	= {0xB5,0x62,0x06,0x00,0x14,0x00,0x01,0x00,0x00,0x00,0xD0,0x08,0x00,0x00,0x00,0x96,0x00,0x00,0x07,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x91,0x84 };
	char g_cUART1_57600_SET[28]  	= {0xB5,0x62,0x06,0x00,0x14,0x00,0x01,0x00,0x00,0x00,0xD0,0x08,0x00,0x00,0x00,0xE1,0x00,0x00,0x07,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0xDC,0xBD };
	char g_cUART1_115200_SET[28]  	= {0xB5,0x62,0x06,0x00,0x14,0x00,0x01,0x00,0x00,0x00,0xD0,0x08,0x00,0x00,0x00,0xC2,0x01,0x00,0x07,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0xBE,0x72 };
	char g_cUART1_230400_SET[28]  	= {0xB5,0x62,0x06,0x00,0x14,0x00,0x01,0x00,0x00,0x00,0xD0,0x08,0x00,0x00,0x00,0x84,0x03,0x00,0x07,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x84,0xE8 };
	char g_cUART1_460800_SET[28]  	= {0xB5,0x62,0x06,0x00,0x14,0x00,0x01,0x00,0x00,0x00,0xD0,0x08,0x00,0x00,0x00,0x08,0x07,0x00,0x07,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x0C,0xBC };
	char g_cUART1_921600_SET[28]  	= {0xB5,0x62,0x06,0x00,0x14,0x00,0x01,0x00,0x00,0x00,0xD0,0x08,0x00,0x00,0x00,0x10,0x0E,0x00,0x07,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x1B,0x5A };

	switch (BAUD230400)
	{
		case BAUD9600:
			UartSendBuffer(&gUartDatPort_2, g_cUART1_9600_SET, sizeof(g_cUART1_9600_SET));	
			break;
		case BAUD19200:
			UartSendBuffer(&gUartDatPort_2, g_cUART1_19200_SET, sizeof(g_cUART1_19200_SET));			
			break;
		case BAUD38400:
			UartSendBuffer(&gUartDatPort_2, g_cUART1_38400_SET, sizeof(g_cUART1_38400_SET));			
			break;
		case BAUD57600:
			UartSendBuffer(&gUartDatPort_2, g_cUART1_57600_SET, sizeof(g_cUART1_57600_SET));			
			break;
		case BAUD115200:
			UartSendBuffer(&gUartDatPort_2, g_cUART1_115200_SET, sizeof(g_cUART1_115200_SET));			
			break;
		case BAUD230400:
			UartSendBuffer(&gUartDatPort_2, g_cUART1_230400_SET, sizeof(g_cUART1_115200_SET));			
			break;
		case BAUD460800:
			UartSendBuffer(&gUartDatPort_2, g_cUART1_460800_SET, sizeof(g_cUART1_115200_SET));			
			break;
		case BAUD921600:
			UartSendBuffer(&gUartDatPort_2, g_cUART1_921600_SET, sizeof(g_cUART1_115200_SET));			
			break;
		default:
			UartSendBuffer(&gUartDatPort_2, g_cUART1_115200_SET, sizeof(g_cUART1_115200_SET));			
			break;
	}

	kal_sleep_task(50);
}


void SetUbloxDataWithStation()
{
	char g_cNAVPOSECEF_Open[16] 	= {0xB5,0x62,0x06,0x01,0x08,0x00,0x01,0x01,0x00,0x01,0x00,0x00,0x00,0x00,0x12,0xB7};
	char g_cNAVPOSECEF_Close[16] 	= {0xB5,0x62,0x06,0x01,0x08,0x00,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x11,0xB2};
	char g_cRAWX_OPEN[16] 			= {0xB5,0x62,0x06,0x01,0x08,0x00,0x02,0x15,0x00,0x01,0x00,0x00,0x00,0x00,0x27,0x4B};
	char g_cRxmSFR_Open[16]    		= {0xB5,0x62,0x06,0x01,0x08,0x00,0x02,0x13,0x00,0x01,0x00,0x00,0x00,0x00,0x25,0x3D};
	char g_cRxmSFR_Close[16]   		= {0xB5,0x62,0x06,0x01,0x08,0x00,0x02,0x13,0x00,0x00,0x00,0x00,0x00,0x00,0x24,0x38};

//	if(g_tBasePose.uiStationType == 0)
//	{
//		UartSendBuffer(&gUartDatPort_2, g_cNAVPOSECEF_Open, sizeof(g_cNAVPOSECEF_Open));
//		kal_sleep_task(2);
//		UartSendBuffer(&gUartDatPort_2, g_cRAWX_OPEN, sizeof(g_cRAWX_OPEN));
//		kal_sleep_task(2);
//		UartSendBuffer(&gUartDatPort_2, g_cRxmSFR_Close, sizeof(g_cRxmSFR_Close));
//		kal_sleep_task(2);
//	}
//	else if(g_tBasePose.uiStationType == 1)
	{
		UartSendBuffer(&gUartDatPort_2, g_cNAVPOSECEF_Close, sizeof(g_cNAVPOSECEF_Close));
		kal_sleep_task(2);
		UartSendBuffer(&gUartDatPort_2, g_cRAWX_OPEN, sizeof(g_cRAWX_OPEN));
		kal_sleep_task(2);
		UartSendBuffer(&gUartDatPort_2, g_cRxmSFR_Open, sizeof(g_cRxmSFR_Open));
		kal_sleep_task(2);
	}

}

void SetUbloxGnss()
{

	char g_cGNSS_SET_GPS_BD[60]		= {0xB5,0x62,0x06,0x3E,0x34,0x00,0x00,0x00,0x20,0x06,0x00,0x08,0x10,0x00,0x01,0x00,0x01,0x01,0x01,0x01,0x03,0x00,0x00,0x00,0x01,0x01,0x03,0x08,0x10,0x00,\
																		 0x01,0x00,0x01,0x01,0x04,0x00,0x08,0x00,0x00,0x00,0x01,0x01,0x05,0x00,0x03,0x00,0x00,0x00,0x01,0x01,0x06,0x08,0x0E,0x00,0x00,0x00,0x01,0x01,0x14,0xE1};
	char g_cGNSS_SET_GPS_BD_16[60]	= {0xB5,0x62,0x06,0x3E,0x34,0x00,0x00,0x00,0x10,0x06,0x00,0x04,0x10,0x00,0x01,0x00,0x01,0x01,0x01,0x01,0x03,0x00,0x00,0x00,0x01,0x01,0x03,0x04,0x10,0x00,\
																		 0x01,0x00,0x01,0x01,0x04,0x00,0x08,0x00,0x00,0x00,0x01,0x01,0x05,0x00,0x03,0x00,0x00,0x00,0x01,0x01,0x06,0x08,0x0E,0x00,0x00,0x00,0x01,0x01,0xFC,0x89};
	char g_cGNSS_SET_GPS_BD_20[60]	= {0xB5,0x62,0x06,0x3E,0x34,0x00,0x00,0x00,0x14,0x06,0x00,0x04,0x10,0x00,0x01,0x00,0x01,0x01,0x01,0x01,0x03,0x00,0x00,0x00,0x01,0x01,0x03,0x04,0x10,0x00,\
																		 0x01,0x00,0x01,0x01,0x04,0x00,0x08,0x00,0x00,0x00,0x01,0x01,0x05,0x00,0x03,0x00,0x00,0x00,0x01,0x01,0x06,0x08,0x0E,0x00,0x00,0x00,0x01,0x01,0x00,0x51};
	char g_cGNSS_SET_GPS[60]		= {0xB5,0x62,0x06,0x3E,0x34,0x00,0x00,0x00,0x10,0x06,0x00,0x08,0x10,0x00,0x01,0x00,0x01,0x01,0x01,0x01,0x03,0x00,0x00,0x00,0x01,0x01,0x03,0x08,0x10,0x00,\
																		 0x00,0x00,0x01,0x01,0x04,0x00,0x08,0x00,0x00,0x00,0x01,0x01,0x05,0x00,0x03,0x00,0x00,0x00,0x01,0x01,0x06,0x08,0x0E,0x00,0x00,0x00,0x01,0x01,0x03,0xA5};
	char g_cTP5_SET[40]				= {0xB5,0x62,0x06,0x31,0x20,0x00,0x00,0x01,0x00,0x00,0x32,0x00,0x00,0x00,0x40,0x42,0x0F,0x00,0x40,0x42,0x0F,0x00,0xA0,0x86,0x01,0x00,0xA0,0x86,0x01,0x00,
																		 0x00,0x00,0x00,0x00,0xF7,0x00,0x00,0x00,0xF1,0x9E};
	char g_cNAV5_SET_Airborne[44]	= {0xB5,0x62,0x06,0x24,0x24,0x00,0xFF,0xFF,0x08,0x03,0x00,0x00,0x00,0x00,0x10,0x27,0x00,0x00,0x05,0x00,0xFA,0x00,0xFA,0x00,0x64,0x00,0x5E,0x01,0x00,0x3C,\
																		 0x00,0x00,0x00,0x00,0xC8,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x51,0x9E};

	UartSendBuffer(&gUartDatPort_2, g_cNAV5_SET_Airborne, sizeof(g_cNAV5_SET_Airborne));	
	kal_sleep_task(2);

//	if(g_tBasePose.uiGNSSType == GPS || g_tBasePose.uiRtkRate == RATE_10HZ)
//	{
//		UartSendBuffer(&gUartDatPort_2, g_cGNSS_SET_GPS, sizeof(g_cGNSS_SET_GPS));			
//	}
//	else
	{
		switch (RATE_1HZ)
		{
			case RATE_1HZ:
			case RATE_2HZ:
				UartSendBuffer(&gUartDatPort_2, g_cGNSS_SET_GPS_BD, sizeof(g_cGNSS_SET_GPS_BD));			
				break;
			case RATE_4HZ:
				UartSendBuffer(&gUartDatPort_2, g_cGNSS_SET_GPS_BD_20, sizeof(g_cGNSS_SET_GPS_BD_20));			
				break;
			case RATE_5HZ:
				UartSendBuffer(&gUartDatPort_2, g_cGNSS_SET_GPS_BD_16, sizeof(g_cGNSS_SET_GPS_BD_16));			
				break;
			default:
				break;
		}
	}	

	kal_sleep_task(2);
	UartSendBuffer(&gUartDatPort_2, g_cTP5_SET, sizeof(g_cTP5_SET));	
	kal_sleep_task(2);
}

void SetUbloxRate()
{

	char g_cRATE_1HZ[14] 	= {0xB5,0x62,0x06,0x08,0x06,0x00,0xE8,0x03,0x01,0x00,0x01,0x00,0x01,0x39};
	char g_cRATE_2HZ[14] 	= {0xB5,0x62,0x06,0x08,0x06,0x00,0xF4,0x01,0x01,0x00,0x01,0x00,0x0B,0x77};
	char g_cRATE_3HZ[14] 	= {0xB5,0x62,0x06,0x08,0x06,0x00,0x4D,0x01,0x01,0x00,0x01,0x00,0x64,0x8D};
	char g_cRATE_4HZ[14] 	= {0xB5,0x62,0x06,0x08,0x06,0x00,0xFA,0x00,0x01,0x00,0x01,0x00,0x10,0x96};
	char g_cRATE_5HZ[14] 	= {0xB5,0x62,0x06,0x08,0x06,0x00,0xC8,0x00,0x01,0x00,0x01,0x00,0xDE,0x6A};
	char g_cRATE_10HZ[14] 	= {0xB5,0x62,0x06,0x08,0x06,0x00,0x64,0x00,0x01,0x00,0x01,0x00,0x7A,0x12};
	char g_cRATE_10HZ2[14] 	= {0xB5,0x62,0x06,0x08,0x06,0x00,0x64,0x00,0x02,0x00,0x01,0x00,0x7B,0x16};

	switch (RATE_5HZ)
	{
		case RATE_1HZ:
			UartSendBuffer(&gUartDatPort_2, g_cRATE_1HZ, sizeof(g_cRATE_1HZ));	
			break;
		case RATE_2HZ:
			UartSendBuffer(&gUartDatPort_2, g_cRATE_2HZ, sizeof(g_cRATE_2HZ));			
			break;
		case RATE_4HZ:
			UartSendBuffer(&gUartDatPort_2, g_cRATE_4HZ, sizeof(g_cRATE_4HZ));			
			break;
		case RATE_5HZ:
			UartSendBuffer(&gUartDatPort_2, g_cRATE_5HZ, sizeof(g_cRATE_5HZ));			
			break;
		case RATE_10HZ:
			UartSendBuffer(&gUartDatPort_2, g_cRATE_10HZ, sizeof(g_cRATE_10HZ));			
			break;
		default:
			break;
	}
}

void SetUblox()
{
	UbloxCloseGGA();
	SetUbloxDataWithStation();
	SetUbloxRate();
	SetUbloxGnss();
	SetUbloxUartBaudrate();
}
